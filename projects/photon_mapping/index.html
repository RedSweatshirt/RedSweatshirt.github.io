<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Global Illumination via Photon Mapping | John Eastman </title> <meta name="author" content="John Eastman"> <meta name="description" content="MIT Computer Graphics (6.837) Final Project"> <meta name="keywords" content="portfolio, portfolio-website, john-eastman, jack-eastman, mit, massachusetts-institute-of-technology, computer-science, computer-graphics, computer-vision, software-engineer, software-developer,"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="/assets/libs/mdb/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="/assets/libs/google_fonts/google-fonts.css"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%8D%81&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://redsweatshirt.github.io/projects/photon_mapping/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> John Eastman </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Global Illumination via Photon Mapping</h1> <p class="post-description">MIT Computer Graphics (6.837) Final Project</p> </header> <article> <div class="container"> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/photon_mapping_6837/rt_cornellbox-480.webp 480w,/assets/img/photon_mapping_6837/rt_cornellbox-800.webp 800w,/assets/img/photon_mapping_6837/rt_cornellbox-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/photon_mapping_6837/rt_cornellbox.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Ray Traced Cornell Box" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/photon_mapping_6837/rt_pm_cornellbox-480.webp 480w,/assets/img/photon_mapping_6837/rt_pm_cornellbox-800.webp 800w,/assets/img/photon_mapping_6837/rt_pm_cornellbox-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/photon_mapping_6837/rt_pm_cornellbox.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Ray Traced Cornell Box with Photon Mapping" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> </div> <div class="caption"> First Image: A ray traced Cornell box replica. Second Image: A ray traced Cornell box with Photon Mapping. </div> <p>During our computer graphics class at MIT (6.837) in Fall 2021, a class partner and I embarked on an exciting project to solve the problem of global illumination. Our aim was to move beyond the simplistic approach of ambient lighting in the Phong shader model and develop a more realistic model that simulates light bouncing around surfaces and reflecting onto other surfaces, creating global illumination. Working together, we chose to implement photon mapping, optimized using a k-d tree data structure. Additionally, we incorporated refraction to power caustics, contributing to a more authentic rendering of the scene.</p> <h4 id="refraction">Refraction</h4> <p>Our refraction implementation was based on a <a href="https://courses.cs.washington.edu/courses/cse457/11au/lectures/markup/ray-tracing-markup.pdf" rel="external nofollow noopener" target="_blank">University of Washington lecture</a> by Daniel Leventhal. We extended our standard ray tracer, which already supported recursive ray bounces for reflection. For refraction, we calculated the angle using Snell’s law, factoring in the index of refraction of the intersected object, and assumed solid glass surfaces for simplicity. We also accounted for total internal reflection using Snell’s law, which resulted in a reflected ray instead of a refracted one for certain ray angles.</p> <h4 id="photon-mapping">Photon Mapping</h4> <div class="container"> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/photon_mapping_6837/rt_pm_cornellbox-480.webp 480w,/assets/img/photon_mapping_6837/rt_pm_cornellbox-800.webp 800w,/assets/img/photon_mapping_6837/rt_pm_cornellbox-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/photon_mapping_6837/rt_pm_cornellbox.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Ray Traced Cornell Box with Photon Mapping" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/photon_mapping_6837/pm_vis_cornellbox-480.webp 480w,/assets/img/photon_mapping_6837/pm_vis_cornellbox-800.webp 800w,/assets/img/photon_mapping_6837/pm_vis_cornellbox-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/photon_mapping_6837/pm_vis_cornellbox.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Cornell Box with Photon Visualization" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> </div> <div class="caption"> First Image: A ray traced Cornell box with Photon Mapping. Second Image: A visualization of 100k photons generated, colors amplified for visibility. </div> <p>Our photon mapping work was based on the paper <a href="https://graphics.stanford.edu/courses/cs348b-00/course8.pdf" rel="external nofollow noopener" target="_blank">“A Practical Guide to Global Illumination using Photon Maps”</a> by Niels Jorgen Christensen and Henrik Wann Jensen, presented at Siggraph 2000. We created the photon map by casting rays randomly from a point light, with each ray representing a photon carrying a portion of the light’s energy. Photons could undergo diffuse reflection, specular reflection, absorption, or refraction upon intersection with an object. To implement caustics, we created a secondary photon map that cast more photons but only stored interactions with refractive materials.</p> <p>We determined each photon’s action on intersection using a technique called “Russian Roulette,” which allowed us to manage the space and time complexity more efficiently. A random number was generated in order to decide the fate of each individual photon for each interaction with an object, based on the contacted material’s properties, specifically diffuse and specular color, as well as assigned values for refraction and reflection, which were used to calculate probabilities of diffuse reflection, specular reflection, absorption, and refraction.</p> <p>For gathering photons, we employed a radiance estimate function that collected all photons within a radius r of the point where the eye rays intersected an object. The power of each photon was scaled based on a cone filter and its contribution to the light at that point, allowing us to approximate the global illumination contribution at that point.</p> <h4 id="k-d-tree-data-structure">k-d Tree Data Structure</h4> <center> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/photon_mapping_6837/rt_perf-480.webp 480w,/assets/img/photon_mapping_6837/rt_perf-800.webp 800w,/assets/img/photon_mapping_6837/rt_perf-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/photon_mapping_6837/rt_perf.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Ray Tracing Performance by Data Structure" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> </center> <div class="caption"> A visualization of ray tracing performance, vector vs. k-d tree </div> <p>Our k-d tree data structure, also based on <a href="https://graphics.stanford.edu/courses/cs348b-00/course8.pdf" rel="external nofollow noopener" target="_blank">“A Practical Guide to Global Illumination using Photon Maps”</a> and the k-d tree implementation published on <a href="https://rosettacode.org/wiki/K-d_tree#C.2B.2B" rel="external nofollow noopener" target="_blank">Rosetta Code</a>, supported the building and balancing of the tree and the GetNeighbors() operation to retrieve nearby photons quickly during the ray tracing process, making rendering much faster than it would be otherwise.</p> <h4 id="results-and-future-work">Results and Future Work</h4> <p>We successfully solved the problem of global illumination using photon mapping, supported by refraction, caustics, and a k-d tree to accelerate the photon gathering step during ray tracing. However, there are potential future improvements, such as extending the refraction implementation to include different materials and using the Fresnel equation, implementing more complex filtering techniques or adding photon mapping for volumetric objects, and expanding the capabilities of the k-d tree.</p> </article> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2024 John Eastman. </div> </footer> <script src="/assets/libs/jquery/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="/assets/libs/mdb/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="/assets/libs/masonry/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="/assets/libs/imagesloaded/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="/assets/libs/medium_zoom/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="/assets/libs/mathjax/tex-mml-chtml.min.js" integrity="sha256-rjmgmaB99riUNcdlrDtcAiwtLIojSxNyUFdl+Qh+rB4=" crossorigin="anonymous"></script> <script defer src="/assets/libs/polyfill/polyfill.min.js" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-SN525KWJ5N"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SN525KWJ5N");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script src="/assets/js/shortcut-key.js"></script> </body> </html>