<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Global Illumination via Photon Mapping | John Eastman</title>
    <meta name="author" content="John  Eastman">
    <meta name="description" content="MIT Computer Graphics (6.837) Final Project">
    <meta name="keywords" content="portfolio, portfolio-website, john-eastman, jack-eastman, mit, massachusetts-institute-of-technology, computer-science, computer-graphics, computer-vision, software-engineer, software-developer,
">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CRoboto+Slab:100,300,400,500,700%7CMaterial+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/autumn.css" media="" id="highlight_theme_light">

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%8D%81&lt;/text&gt;&lt;/svg&gt;">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://redsweatshirt.github.io/projects/photon_mapping/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/monokai.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav sticky-bottom-footer">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="//">John Eastman</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/cv/">cv</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">projects</a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      <!-- page.html -->
        <div class="post">

          <header class="post-header">
            <h1 class="post-title">Global Illumination via Photon Mapping</h1>
            <p class="post-description">MIT Computer Graphics (6.837) Final Project</p>
          </header>

          <article>
            <div class="container">
    <div class="row justify-content-sm-center">
        <div class="col-sm mt-3 mt-md-0">
            <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/photon_mapping_6837/rt_cornellbox-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/photon_mapping_6837/rt_cornellbox-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/photon_mapping_6837/rt_cornellbox-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/photon_mapping_6837/rt_cornellbox.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Ray Traced Cornell Box" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

        </div>
        <div class="col-sm mt-3 mt-md-0">
            <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/photon_mapping_6837/rt_pm_cornellbox-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/photon_mapping_6837/rt_pm_cornellbox-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/photon_mapping_6837/rt_pm_cornellbox-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/photon_mapping_6837/rt_pm_cornellbox.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Ray Traced Cornell Box with Photon Mapping" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

        </div>
    </div>
</div>
<div class="caption">
    First Image: A ray traced Cornell box replica. Second Image: A ray traced Cornell box with Photon Mapping.
</div>

<p>During our computer graphics class at MIT (6.837) in Fall 2021, a class partner and I embarked on an exciting project to solve the problem of global illumination. Our aim was to move beyond the simplistic approach of ambient lighting in the Phong shader model and develop a more realistic model that simulates light bouncing around surfaces and reflecting onto other surfaces, creating global illumination. Working together, we chose to implement photon mapping, optimized using a k-d tree data structure. Additionally, we incorporated refraction to power caustics, contributing to a more authentic rendering of the scene.</p>

<h4 id="refraction">Refraction</h4>

<p>Our refraction implementation was based on a <a href="https://courses.cs.washington.edu/courses/cse457/11au/lectures/markup/ray-tracing-markup.pdf" rel="external nofollow noopener" target="_blank">University of Washington lecture</a> by Daniel Leventhal. We extended our standard ray tracer, which already supported recursive ray bounces for reflection. For refraction, we calculated the angle using Snell’s law, factoring in the index of refraction of the intersected object, and assumed solid glass surfaces for simplicity. We also accounted for total internal reflection using Snell’s law, which resulted in a reflected ray instead of a refracted one for certain ray angles.</p>

<h4 id="photon-mapping">Photon Mapping</h4>
<div class="container">
    <div class="row justify-content-sm-center">
        <div class="col-sm mt-3 mt-md-0">
            <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/photon_mapping_6837/rt_pm_cornellbox-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/photon_mapping_6837/rt_pm_cornellbox-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/photon_mapping_6837/rt_pm_cornellbox-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/photon_mapping_6837/rt_pm_cornellbox.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Ray Traced Cornell Box with Photon Mapping" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

        </div>
        <div class="col-sm mt-3 mt-md-0">
            <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/photon_mapping_6837/pm_vis_cornellbox-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/photon_mapping_6837/pm_vis_cornellbox-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/photon_mapping_6837/pm_vis_cornellbox-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/photon_mapping_6837/pm_vis_cornellbox.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Cornell Box with Photon Visualization" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

        </div>
    </div>
</div>
<div class="caption">
    First Image: A ray traced Cornell box with Photon Mapping. Second Image: A visualization of 100k photons generated, colors amplified for visibility.
</div>

<p>Our photon mapping work was based on the paper <a href="https://graphics.stanford.edu/courses/cs348b-00/course8.pdf" rel="external nofollow noopener" target="_blank">“A Practical Guide to Global Illumination using Photon Maps”</a> by Niels Jorgen Christensen and Henrik Wann Jensen, presented at Siggraph 2000. We created the photon map by casting rays randomly from a point light, with each ray representing a photon carrying a portion of the light’s energy. Photons could undergo diffuse reflection, specular reflection, absorption, or refraction upon intersection with an object. To implement caustics, we created a secondary photon map that cast more photons but only stored interactions with refractive materials.</p>

<p>We determined each photon’s action on intersection using a technique called “Russian Roulette,” which allowed us to manage the space and time complexity more efficiently. A random number was generated in order to decide the fate of each individual photon for each interaction with an object, based on the contacted material’s properties, specifically diffuse and specular color, as well as assigned values for refraction and reflection, which were used to calculate probabilities of diffuse reflection, specular reflection, absorption, and refraction.</p>

<p>For gathering photons, we employed a radiance estimate function that collected all photons within a radius r of the point where the eye rays intersected an object. The power of each photon was scaled based on a cone filter and its contribution to the light at that point, allowing us to approximate the global illumination contribution at that point.</p>

<h4 id="k-d-tree-data-structure">k-d Tree Data Structure</h4>

<center>
    <div class="row justify-content-sm-center">
        <div class="col-sm mt-3 mt-md-0">
            <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/photon_mapping_6837/rt_perf-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/photon_mapping_6837/rt_perf-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/photon_mapping_6837/rt_perf-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/photon_mapping_6837/rt_perf.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Ray Tracing Performance by Data Structure" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

        </div>
    </div>
</center>
<div class="caption">
    A visualization of ray tracing performance, vector vs. k-d tree
</div>

<p>Our k-d tree data structure, also based on <a href="https://graphics.stanford.edu/courses/cs348b-00/course8.pdf" rel="external nofollow noopener" target="_blank">“A Practical Guide to Global Illumination using Photon Maps”</a> and the k-d tree implementation published on <a href="https://rosettacode.org/wiki/K-d_tree#C.2B.2B" rel="external nofollow noopener" target="_blank">Rosetta Code</a>, supported the building and balancing of the tree and the GetNeighbors() operation to retrieve nearby photons quickly during the ray tracing process, making rendering much faster than it would be otherwise.</p>

<h4 id="results-and-future-work">Results and Future Work</h4>

<p>We successfully solved the problem of global illumination using photon mapping, supported by refraction, caustics, and a k-d tree to accelerate the photon gathering step during ray tracing. However, there are potential future improvements, such as extending the refraction implementation to include different materials and using the Fresnel equation, implementing more complex filtering techniques or adding photon mapping for volumetric objects, and expanding the capabilities of the k-d tree.</p>

          </article>

        </div>

    </div>

    <!-- Footer -->    <footer class="sticky-bottom mt-5">
      <div class="container">
        © Copyright 2023 John  Eastman. 
      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script defer src="/assets/js/common.js"></script>
  <script defer src="/assets/js/copy_code.js" type="text/javascript"></script>

    
  <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
  <script async src="https://badge.dimensions.ai/badge.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SN525KWJ5N"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ window.dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-SN525KWJ5N');
  </script>
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>
</html>
